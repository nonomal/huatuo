
# The global blacklist for tracing and metrics
BlackList = ["netdev_hw"]

# Log Configuration
#
# - Level
# The log level for huatuo-bamai: Debug, Info, Warn, Error, Panic.
# Default: Info
#
# - File
# Store logs to where the logging file is. If it is empty, don't write log
# to any file.
# Default: empty
#
[Log]
    # Level = "Info"
    # File = ""

# Runtime resource limit
#
# - LimitInitCPU
# During the huatuo-bamai startup, the CPU of process are restricted from use.
# Default is 0.5 CPU.
#
# - LimitCPU
# The CPU resource restricted once the process starts.
# Default is 2.0 CPU.
#
# - LimitMem
# The memory resource limitted for huatuo-bamai process.
# Default is 2048MB.
#
[RuntimeCgroup]
    # LimitInitCPU = 0.5
    # LimitCPU = 2.0
    # LimitMem = 2048

# Storage configuration
[Storage]
    # Elasticsearch Storage
    #
    # Disable ES storage if one of Address, Username, Password is empty.
    # Store the tracing and events data of linux kernel to ES.
    #
    # - Address
    # Default address is :9200 of localhost. Port 9200 is used for all API calls
    # over HTTP. This includes search and aggregations, monitoring and anything
    # else that uses a HTTP request. All client libraries will use this port to
    # talk to Elasticsearch
    # Default: :9200
    #
    # - Index
    # Elasticsearch index, a logical namespace that holds a collection of
    # documents for huatuo-bamai.
    # Default: huatuo_bamai
    #
    # - Username
    # - Password
    # There is no default username and password.
    #
    [Storage.ES]
        # Address = "http://127.0.0.1:9200"
        # Index = "huatuo_bamai"
        Username = "elastic"
        Password = "huatuo-bamai"

    # LocalFile Storage
    #
    # Store data to local directory for troubleshooting on the host machine.
    #
    # - Path
    # The directory for storing data.
    # Default: "huatuo-local"
    #
    # - RotationSize
    # The maximum size in Megabytes of a record file before it gets rotated
    # for per linux kernel tracer.
    # Default: 100MB
    #
    # - MaxRotation
    # The maximum number of old log files to retain for per tracer.
    # Default: 10
    #
    [Storage.LocalFile]
        # Path = "huatuo-local"
        # RotationSize = 100
        # MaxRotation = 10

# Autotracing configuration 
[AutoTracing]
    # cpuidle
    #
    # For a high cpu usage all of a sudden in containers.
    #
    # - UserThreshold
    # User CPU usage threshold, when cpu usage reaches this threshold, cpu
    # performance tracing will be triggered.
    # Default: 75%
    #
    # - SysThreshold
    # System CPU usage threshold, when reaching this threshold, cpu performance
    # tracing will be triggered.
    # Default: 45%
    #
    # - UsageThreshold
    # The total cpu usage (system + user cpu usage) threshold, when reaching
    # this threshold, cpu performance tracing will be triggered.
    # Default: 45%
    #
    # - DeltaUserThreshold
    # The range of this user cpu changes within a short period of time.
    # Default: 45%
    #
    # - DeltaSysThreshold
    # The range of this system cpu changes within a short period of time.
    # Default: 20%
    #
    # - DeltaUsageThreshold
    # The range of this cpu usage changes within a short period of time.
    # Default: 55%
    #
    # - Interval
    # The sample interval of the cpu usage for all containers.
    # Default: 10s
    #
    # - IntervalContinuousRun
    # Time since last run. Avoid frequently executing this tracing to prevent
    # damage to the system.
    # Default: 1800s
    #
    # - PerfRunTimeOut
    # The executing time of this tracing program.
    # Default: 10s
    # 
    # NOTE:
    # Running this performance tool, when:
    # 1. UserThreshold and DeltaUserThreshold are true, or
    # 2. SysThreshold and DeltaSysThreshold are true, or
    # 3. UsageThreshold and DeltaUsageThreshold
    #
    [AutoTracing.CPUIdle]
        # UserThreshold = 75
        # SysThreshold = 45
        # UsageThreshold = 90
        # DeltaUserThreshold = 45
        # DeltaSysThreshold = 20
        # DeltaUsageThreshold = 55
        # Interval = 10
        # IntervalContinuousRun = 1800
        # PerfRunTimeOut = 10

    # cpusys
    #
    # For a high system cpu usage all of a sudden on host machine.
    #
    # - SysThreshold
    # System CPU usage threshold, when reaching this threshold, cpu performance
    # tracing will be triggered.
    # Default: 45%
    #
    # - DeltaSysThreshold
    # The range of system cpu changes within a short period of time.
    # Default: 20%
    #
    # - Interval
    # The sample interval of the cpu usage for host machine.
    # Default: 10s
    #
    # - PerfRunTimeOut
    # The executing time of this tracing program.
    # Default: 10s
    #
    # NOTE:
    # Running this performance tool, when:
    # SysThreshold and DeltaSysThreshold are true.
    #
    [AutoTracing.CPUSys]
        # SysThreshold = 45
        # DeltaSysThreshold = 20
        # Interval = 10
        # PerfRunTimeOut = 10

    # dload
    #
    # linux tasks D state profiling for containers.
    #
    # - ThresholdLoad
    # The loadavg threshold value, when reaching this threshold, dload profiling
    # is triggered.
    # Defalut: 5
    #
    [AutoTracing.Dload]
        # ThresholdLoad = 5
        # MonitorGap = 180
    
    # iotracing
    #
    # io profiling for containers.
    #
    # - WbpsThreshold
    # Max write bytes per second, when reaching this threshold, iotracing is triggered.
    # Please note that if it is an NVMe device, it must also meet the UtilThreshold.
    # Defalut: 1500 MB/s
    #
    # - RbpsThreshold
    # Max read bytes per second, when reaching this threshold, iotracing is triggered.
    # Please note that if it is an NVMe device, it must also meet the UtilThreshold.
    # Defalut: 2000 MB/s
    #
    # - UtilThreshold
    # Disk utilization, Percentage of time the disk is busy. If this is consistently
    # above 80-90%, the disk may be a bottleneck.
    # Defalut: 90%
    #
    # - AwaitThreshold
    # Await (Average IO wait time in ms): High values indicate slow disk response times.
    # Defalut: 100ms
    #
    # - RunIOTracingTimeout
    # The executing time of this tracing tool.
    # Default: 10s
    #
    # - MaxProcDump
    # The number of processes displayed by iotracing tool.
    # Defalut: 10
    #
    # - MaxFilesPerProcDump
    # The number of files per process displayed by iotracing tool.
    # Defalut: 5
    #
    [AutoTracing.IOTracing]
        # WbpsThreshold = 1500
        # RbpsThreshold = 2000
        # UtilThreshold = 90
        # AwaitThreshold = 100
        # RunIOTracingTimeout = 10
        # MaxProcDump = 10
        # MaxFilesPerProcDump = 5

    # memory burst
    #
    # If there is a memory used burst on the host, capture this kernel context.
    #
    # - Interval
    # The sample interval of the memory used.
    # Default: 10s
    #
    # - DeltaMemoryBurst
    # A certain percentage of memory burst used. 100% that means, e.g.,
    # memory used increased from 200MB to 400MB.
    # Default: 100%
    #
    # - DeltaAnonThreshold
    # A certain percentage of anon memory burst used. 100% that means, e.g.,
    # anon memory used increased from 200MB to 400MB.
    # Default: 70%
    #
    # - IntervalContinuousRun
    # Time since last run. Avoid frequently executing this tracing
    # to prevent damage to the system.
    # Default: 1800s
    #
    # - DumpProcessMaxNum
    # How many processes to dump when this event is triggered.
    # Default: 10
    #
    [AutoTracing.MemoryBurst]
        # DeltaMemoryBurst = 100
        # DeltaAnonThreshold = 70
        # Interval = 10
        # IntervalContinuousRun = 1800
        # SlidingWindowLength = 60
        # DumpProcessMaxNum = 10

# linux kernel events capturing configuration
[EventTracing]
    # softirq 
    #
    # tracing the softirq disabled events of linux kernel.
    #
    # - DisabledThreshold
    # When the disable duration of softirq exceeds the threshold, huatuo-bamai
    # will collect kernel context.
    # Defalut: 10000000 in nanoseconds, 10ms
    #
    [EventTracing.Softirq]
        # DisabledThreshold = 10000000

    # memreclaim
    #
    # The memory reclaim may block the process, if one process is blocked
    # for a long time, reporting the events to userspace.
    #
    # - BlockedThreshold
    # The blocked time when memory reclaiming.
    # Default: 900000000ns, 900ms
    #
    [EventTracing.MemoryReclaim]
        # BlockedThreshold = 900000000

    # networking rx latency
    #
    # linux net stack rx latency for every tcp skbs.
    #
    # - Driver2NetRx
    # The latency from driver to net rx, e.g., netif_receive_skb. 
    # Default: 5ms
    #
    # - Driver2TCP
    # The latency from driver to tcp rx, e.g., tcp_v4_rcv. 
    # Default: 10ms
    #
    # - Driver2Userspace
    # The latency from driver to userspace copy data, e.g., skb_copy_datagram_iovec. 
    # Default: 115ms
    #
    # - ExcludedContainerQos
    # Don't care the containers which qos level is in ExcludedContainerQos.
    # This is a string slice in vendor/k8s.io/api/core/v1/types.go
    # - PodQOSGuaranteed = "Guaranteed"
    # - PodQOSBurstable = "Burstable"
    # - PodQOSBestEffort = "BestEffort"
    #
    # Default: []
    #
    # - ExcludedHostNetnamespace
    # Don't care the skbs, packets in the host net namespace.
    # Default: true
    #
    [EventTracing.NetRxLatency]
        # Driver2NetRx = 5
        # Driver2TCP = 10
        # Driver2Userspace = 115
        # ExcludedContainerQos = []
        ExcludedContainerQos = ["bestEffort"]
        # ExcludedHostNetnamespace = true

    # netdev events
    #
    # monitor the net device events.
    #
    # - DeviceList
    # The net devices we take care of.
    # Default: [] is empty, meaning no devices.
    #
    [EventTracing.Netdev]
        DeviceList = ["eth0", "eth1", "bond4", "lo"]

    # dropwatch
    #
    # monitor packets dropped events in the Linux kernel. 
    #
    # - ExcludedNeighInvalidate
    # Don't care of neigh_invalidate drop events.
    # Default: true
    #
    [EventTracing.Dropwatch]
        # ExcludedNeighInvalidate = true

# Metric Collector
[MetricCollector]
    # Netdev statistic
    #
    # - EnableNetlink
    # Use netlink instead of procfs net/dev to get netdev statistic.
    # Only support the host environment to use `netlink` now.
    # Default is "false".
    #
    # - DeviceIncluded
    # Accept special devices in netdev statistic.
    # Default: [] is empty, meaning include all.
    #
    # - DeviceExcluded
    # Exclude special devices in netdev statistic. 'DeviceExcluded' has higher
    # priority than 'DeviceIncluded'.
    # Default: [] is empty, meaning ignore nothing.
    #
    [MetricCollector.NetdevStats]
        # EnableNetlink = false
        # DeviceIncluded = ""
        DeviceExcluded = "^(lo)|(docker\\w*)|(veth\\w*)$"
    
    # netdev dcb, DCB (Data Center Bridging)
    #
    # Collecting the DCB PFC (Priority-based Flow Control).
    #
    # - DeviceList
    # The net devices we take care of.
    # Default: [] is empty, meaning no devices.
    #
    [MetricCollector.NetdevDCB]
        DeviceList = ["eth0", "eth1"]
    
    # netdev hardware statistic
    #
    # Collecting the hardware statistic of net devices, e.g, rx_dropped.
    #
    # - DeviceList
    # The net devices we take care of.
    # Default: [] is empty, meaning no devices.
    #
    [MetricCollector.NetdevHW]
        DeviceList = ["eth0", "eth1"]

    # Qdisc
    #
    # - DeviceIncluded
    # - DeviceExcluded same as above.
    #
    [MetricCollector.Qdisc]
        # DeviceIncluded = ""
        DeviceExcluded = "^(lo)|(docker\\w*)|(veth\\w*)$"

    # vmstat
    #
    # - DeviceInclude
    # - DeviceExclude same as above.
    #
    [MetricCollector.Vmstat]
        Included = "allocstall|nr_active_anon|nr_active_file|nr_boost_pages|nr_dirty|nr_free_pages|nr_inactive_anon|nr_inactive_file|nr_kswapd_boost|nr_mlock|nr_shmem|nr_slab_reclaimable|nr_slab_unreclaimable|nr_unevictable|nr_writeback|numa_pages_migrated|pgdeactivate|pgrefill|pgscan_direct|pgscan_kswapd|pgsteal_direct|pgsteal_kswapd"
        Excluded = "total"
    
    # MemoryStat/MemoryEvents/Netstat/MountPointStat
    #
    # - Included
    # - Excluded same as above, DeviceInclude, DeviceExclude.
    #
    [MetricCollector.MemoryStat]
        Included = "active_anon|active_file|dirty|inactive_anon|inactive_file|pgdeactivate|pgrefill|pgscan_direct|pgscan_kswapd|pgsteal_direct|pgsteal_kswapd|shmem|unevictable|writeback|pgscan_globaldirect|pgscan_globalkswapd|pgscan_cswapd|pgsteal_cswapd|pgsteal_globaldirect|pgsteal_globalkswapd"
        Excluded = "total"
    [MetricCollector.MemoryEvents]
        Included = "watermark_inc|watermark_dec"
        # Excluded = ""
    [MetricCollector.Netstat]
        # Excluded = ""
        # Included = ""

    # MountPointStat
    [MetricCollector.MountPointStat]
        MountPointsIncluded = "(^/home$)|(^/$)|(^/boot$)"

# Pod Configuration
#
# Configure these parameters for fetching pods from kubelet.
#
# - KubeletReadOnlyPort
# The KubeletReadOnlyPort is kubelet read-only port for the Kubelet to serve on with
# no authentication/authorization. The port number must be between 1 and 65535, inclusive.
# Setting this field to 0 disables fetching pods from kubelet read-only service.
# Default: 10255
#
# - KubeletAuthorizedPort
# The port is the HTTPs port of the kubelet. The port number must be between 1 and 65535,
# inclusive. Setting this field to 0 disables fetching pods from kubelet HTTPS port.
# Default: 10250
#
# - KubeletClientCertPath
# https://kubernetes.io/docs/setup/best-practices/certificates/
#
# Client certificate and private key file name. One file or two files:
# "/path/to/xxx-kubelet-client.crt,/path/to/xxx-kubelet-client.key",
# "/path/to/kubelet-client-current.pem"
#
# You can disable this kubelet fetching pods, for bare metal service, by
# KubeletReadOnlyPort = 0, and KubeletAuthorizedPort = 0.
#
[Pod]
    KubeletClientCertPath = "/etc/kubernetes/pki/apiserver-kubelet-client.crt,/etc/kubernetes/pki/apiserver-kubelet-client.key"
